# Alpha JPG
Webサイトに半透過のPNGをすることはデザインの面で大きなメリットがありますが、その反面、ファイルサイズが大きくなり、pixelサイズが大きな場合はファイルサイズが1MBを超えてしまう場合もあります。 もちろん、そのようなメガを超えるようなファイルを使用するわけにはいかず、デザイン時の足かせになりがちです。
こういったPNGのファイルサイズに悩まされているときは、こちらのツールがお役に立てるかもしれません。

## 動作している画面
<https://dai3110.github.io/alpha_jpg/>


## 概要
このツールでは、半透過のPNGファイルを２つのJPGファイルに変換します。
１つは透過データを除いた画像ファイル、もう１つは透過データのみを持った画像ファイル（アルファマスク）です。
これら２つの画像をWebサイト上ブレンドすることで、元の半透過PNGファイルを復元します。
ファイルサイズは（元画像・画質レベルによりますが）おおよそ1/3ほどに、大きいものでは1/20に減らせる場合もあります。

## 大まかな手順
この画面上でPNGファイル（またはGIF）を選択すると、対象の画像が表示されます。 JPEGの画質レベルを適当な数値にし、「JPG化した画像をZIPで保存」を押下すると、生成されたJPGファイルを含むサンプルセットがZIP書庫となって保存されます。
このサンプルに含まれるJSファイルと同等の記述をWebサイト側のJavaScriptに追記し、元の<img>要素のsrcをJPGに変更、data-alpha-mask属性を加えることで、半透過のPNGファイルが復元されます。

## 仕組み
バックグラウンドで一時的に<canvas>を生成し、メインのJPGファイルとマスクのJPGのそれぞれのpixelデータを読み込みます。 メイン側のrgbaデータのうち、透明度に相当する a(=alpha) のデータをマスクJPGで同じ位置にあるpixelの明度で上書きし、合成したcanvas上の画像をPNGとして出力します。
元の<img>のsrc属性は このPNGのdataスキーム（base64）に書き換え、元のNodeTreeを変えることなく半透過画像に置換されます。


## 今後の展望
1. 背景画像用のJSを追加するかも知れません。
2. node.js版を作成するかも知れません。
