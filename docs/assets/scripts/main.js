window.AlphaJpgApp = window.AlphaJpgApp || {};(function(){	var HeredocTypeException = function(value){		this.value = value.toString();		this.message = "Heredoc argument requires as a function contains a block comment.";		this.toString = function(){			return this.message + "\n" + this.value;		};	};		var HeredocSyntaxException = function(value){		this.value = value.toString();		this.message = "Heredoc argument must contain a block comment.";		this.toString = function(){			return this.message + "\n" + this.value;		};	};	window.AlphaJpgApp.util = {		heredoc : function(exp, trimIndent){			var commentExp = { start : "/*", end : "*/" };			if(typeof exp != "function"){				throw new HeredocTypeException(exp);			}			var docContent = exp.toString();			if(!~docContent.indexOf(commentExp.start) || !~docContent.indexOf(commentExp.end)){				throw new HeredocSyntaxException(exp);			}			docContent = docContent.slice(docContent.indexOf(commentExp.start) + commentExp.start.length);			docContent = docContent.slice(0, docContent.indexOf(commentExp.end));			docContent = docContent.replace(/^([\n|\r\n|\r]+)/, "");						var lines = docContent.split(/[\r|\r\n|\n]/);			if(lines.length && !(lines[0].trim())){				lines.shift();			}			if(lines.length && !(lines[lines.length-1].trim())){				lines.pop();			}						if(!!trimIndent){				var indentLength = 9999;				for(var i=0; i<lines.length; i++){					indentLength = Math.min(indentLength, lines[i].match(/^[ \t]*/)[0].length);				}								for(var i=0; i<lines.length; i++){					lines[i] = lines[i].replace(new RegExp("^([ \t]{" + indentLength + "})"), "");				}			}			docContent = lines.join("\n");			return docContent;		},		zip : (function(){			if(!!JSZip){				return JSZip;			}			throw new Error("requires JSZip");		})(),		saveAs : (function(){			if(!!saveAs){				return saveAs;			}			throw new Error("requires saveAs");		})()	};})();
window.AlphaJpgApp = window.AlphaJpgApp || {};(function(){    var fileContents = {        js : AlphaJpgApp.util.heredoc(function(){/*            (function(){                var Alpha = {                    mask : function(elm){                        var replace = function(original, mask){                            var canvas = document.createElement("canvas");                            canvas.setAttribute("width", original.naturalWidth);                            canvas.setAttribute("height", original.naturalHeight);                                                        var con = canvas.getContext("2d");                            con.drawImage(mask, 0, 0);                                                        var maskImageData = con.getImageData(0, 0, original.naturalWidth, original.naturalHeight);                                                        con.drawImage(original, 0, 0);                            var mainImageData = con.getImageData(0, 0, original.naturalWidth, original.naturalHeight);                                                        for(var i=0; i<mainImageData.data.length; i+=4){                                (function(pos){                                    mainImageData.data[pos + 3] = maskImageData.data[pos];                                })(i);                            }                            con.putImageData(mainImageData, 0, 0);                                                        original.dataset.originalImage = original.getAttribute("src");                            original.src = canvas.toDataURL("image/png");                        };                        var mask = new Image();                        mask.addEventListener("load", function(){                            replace(elm, mask);                        }, false);                        mask.src = elm.dataset.alphaMask;                    }                };                document.addEventListener("DOMContentLoaded", function(){                    var alphaElements = document.querySelectorAll('[data-alpha-mask]');                    for(var i=0; i<alphaElements.length; i++){                        (function(elm){                            if(!elm.complete){                                var mask = function(){                                    Alpha.mask(elm);                                    elm.removeEventListener("load", mask, false);                                };                                elm.addEventListener("load", mask, false);                            }                            else{                                Alpha.mask(elm);                            }                        })(alphaElements[i]);                    }                }, false);            })();        */}, true),        html : AlphaJpgApp.util.heredoc(function(){/*            <html>                <head>                    <meta charset="UTF-8">                    <script src="alpha.js"></script>                    <style> body{ background-image : url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIBFC0YMIVMMgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAL0lEQVQ4y2NcsGDBfwY8ID4+Hp80AxMDhWDUgMFgAOP////xpoOFCxeOBuLwNwAA6aMJ+gCSWQwAAAAASUVORK5CYII='); }</style>                </head>                <body>                    <img src="%NAME%.jpg" data-alpha-mask="%NAME%_mask.jpg">                </body>            </html>        */}, true)    };    AlphaJpgApp.fileContents = fileContents;})();
window.AlphaJpgApp = window.AlphaJpgApp || {};(function(){	AlphaJpgApp.toZipFile = function(mainBlob, maskBlob){		var zip = new AlphaJpgApp.util.zip();		var sliceTill = currentFileName.indexOf(".");		var name = currentFileName.slice(0, sliceTill < 0 ? currentFileName.length : sliceTill);		var docRoot = zip.folder("htdocs");		docRoot.file("alpha.js", AlphaJpgApp.fileContents.js);		docRoot.file("index.html", AlphaJpgApp.fileContents.html.replace(/%NAME%/g, name));		docRoot.file(name + ".jpg", mainBlob, { binary : true });		docRoot.file(name + "_mask.jpg", maskBlob, { binary : true });		AlphaJpgApp.util.saveAs(zip.generate({ type : "blob" }), name + ".zip");	};})();
window.AlphaJpgApp = window.AlphaJpgApp || {};(function(){	var clearCanvas = function(imageResultArea, mainCanvas, maskCanvas){		if(!!mainCanvas.width && !!mainCanvas.height){			mainCanvas.getContext("2d").clearRect(0, 0, mainCanvas.width, mainCanvas.height);		}		if(!!maskCanvas.width && !!maskCanvas.height){			maskCanvas.getContext("2d").clearRect(0, 0, maskCanvas.width, maskCanvas.height);		}				var resultImages = imageResultArea.querySelectorAll("IMG");		for(var i=0; i<resultImages.length; i++){			resultImages[i].parentNode.removeChild(resultImages[i]);		}	};		var confirmImage = function(elements){		var file = elements.imageInput.files[0];		var reader = new FileReader();		reader.onloadend = function(){			elements.confirmImage.parentNode.parentNode.classList.remove("noimage");			elements.confirmImage.src = reader.result;		}		if(!!file){			reader.readAsDataURL(file);			clearCanvas(elements.imageResults, elements.mainCanvas, elements.maskCanvas);			currentFileName = file.name;						elements.filesizeInfo.innerHTML = file.size + "byte";		}		else{			elements.confirmImage.src = "";			elements.confirmImage.parentNode.parentNode.classList.add("noimage");			clearCanvas(elements.imageResults, elements.mainCanvas, elements.maskCanvas);		}	};		var canvas2jpg = function(canvas, jpgLevel){		var dataurl = canvas.toDataURL("image/jpeg", jpgLevel);		var bin = atob(dataurl.split(",")[1]);		var buffer = new Uint8Array(bin.length);		for(var i=0; i<bin.length; i++){			buffer[i] = bin.charCodeAt(i);		}		return buffer;	};		var conv2jpg = function(elements){		var jpgLevel = Math.min(1, Math.max(0, elements.jpgLebelInput.value / 100));		var src = elements.confirmImage.getAttribute("src");		var canvases = {			main : elements.mainCanvas,			mask : elements.maskCanvas		};		clearCanvas(elements.imageResults, elements.mainCanvas, elements.maskCanvas);				for(var type in canvases){			(function(canvas){				var con = canvas.getContext("2d");				canvas.setAttribute("width", elements.confirmImage.naturalWidth);				canvas.setAttribute("height", elements.confirmImage.naturalHeight);				con.drawImage(elements.confirmImage, 0, 0);			})(canvases[type]);		}				var mainCon = canvases.main.getContext("2d");		var mainImageData = mainCon.getImageData(0, 0, elements.confirmImage.naturalWidth, elements.confirmImage.naturalHeight);		for(var i=0; i<mainImageData.data.length; i+=4){			(function(pos){				mainImageData.data[pos + 3] = 255;			})(i);		}		mainCon.putImageData(mainImageData, 0, 0);		var maskCon = canvases.mask.getContext("2d");		var maskImageData = maskCon.getImageData(0, 0, elements.confirmImage.naturalWidth, elements.confirmImage.naturalHeight);		for(var i=0; i<maskImageData.data.length; i+=4){			(function(pos){				maskImageData.data[pos + 0] = maskImageData.data[pos + 3];				maskImageData.data[pos + 1] = maskImageData.data[pos + 3];				maskImageData.data[pos + 2] = maskImageData.data[pos + 3];				maskImageData.data[pos + 3] = 255;							})(i);		}		maskCon.putImageData(maskImageData, 0, 0);		AlphaJpgApp.toZipFile(canvas2jpg(canvases.main, jpgLevel), canvas2jpg(canvases.mask, jpgLevel));	};	AlphaJpgApp.setup = function(elements){		elements.imageInput.addEventListener("change", function(){			confirmImage(elements);		}, false);				elements.createTrigger.addEventListener("click", function(){			conv2jpg(elements);		}, false);	};})();
window.AlphaJpgApp = window.AlphaJpgApp || {};document.addEventListener("DOMContentLoaded", function(){	AlphaJpgApp.setup({		imageInput : document.getElementById("image_input"),		imageResults : document.getElementById("image_results"),		mainCanvas : document.getElementById("main_canvas"),		maskCanvas : document.getElementById("mask_canvas"),		filesizeInfo : document.getElementById("filesize"),		confirmImage : document.querySelector("#confirm_img > IMG"),		createTrigger : document.getElementById("image_create"),		jpgLebelInput : document.getElementById("image_level"),			});}, false);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl91dGlsLmpzIiwiX2NvbnRlbnQuanMiLCJfemlwLmpzIiwiX2NyZWF0b3IuanMiLCJtYWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUNBQTtBQ0FBO0FDQUEiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIndpbmRvdy5BbHBoYUpwZ0FwcCA9IHdpbmRvdy5BbHBoYUpwZ0FwcCB8fCB7fTtcclxyKGZ1bmN0aW9uKCl7XHJcdHZhciBIZXJlZG9jVHlwZUV4Y2VwdGlvbiA9IGZ1bmN0aW9uKHZhbHVlKXtcclx0XHR0aGlzLnZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcclx0XHR0aGlzLm1lc3NhZ2UgPSBcIkhlcmVkb2MgYXJndW1lbnQgcmVxdWlyZXMgYXMgYSBmdW5jdGlvbiBjb250YWlucyBhIGJsb2NrIGNvbW1lbnQuXCI7XHJcdFx0dGhpcy50b1N0cmluZyA9IGZ1bmN0aW9uKCl7XHJcdFx0XHRyZXR1cm4gdGhpcy5tZXNzYWdlICsgXCJcXG5cIiArIHRoaXMudmFsdWU7XHJcdFx0fTtcclx0fTtcclx0XHJcdHZhciBIZXJlZG9jU3ludGF4RXhjZXB0aW9uID0gZnVuY3Rpb24odmFsdWUpe1xyXHRcdHRoaXMudmFsdWUgPSB2YWx1ZS50b1N0cmluZygpO1xyXHRcdHRoaXMubWVzc2FnZSA9IFwiSGVyZWRvYyBhcmd1bWVudCBtdXN0IGNvbnRhaW4gYSBibG9jayBjb21tZW50LlwiO1xyXHRcdHRoaXMudG9TdHJpbmcgPSBmdW5jdGlvbigpe1xyXHRcdFx0cmV0dXJuIHRoaXMubWVzc2FnZSArIFwiXFxuXCIgKyB0aGlzLnZhbHVlO1xyXHRcdH07XHJcdH07XHJcclx0d2luZG93LkFscGhhSnBnQXBwLnV0aWwgPSB7XHJcdFx0aGVyZWRvYyA6IGZ1bmN0aW9uKGV4cCwgdHJpbUluZGVudCl7XHJcdFx0XHR2YXIgY29tbWVudEV4cCA9IHsgc3RhcnQgOiBcIi8qXCIsIGVuZCA6IFwiKi9cIiB9O1xyXHRcdFx0aWYodHlwZW9mIGV4cCAhPSBcImZ1bmN0aW9uXCIpe1xyXHRcdFx0XHR0aHJvdyBuZXcgSGVyZWRvY1R5cGVFeGNlcHRpb24oZXhwKTtcclx0XHRcdH1cclx0XHRcdHZhciBkb2NDb250ZW50ID0gZXhwLnRvU3RyaW5nKCk7XHJcdFx0XHRpZighfmRvY0NvbnRlbnQuaW5kZXhPZihjb21tZW50RXhwLnN0YXJ0KSB8fCAhfmRvY0NvbnRlbnQuaW5kZXhPZihjb21tZW50RXhwLmVuZCkpe1xyXHRcdFx0XHR0aHJvdyBuZXcgSGVyZWRvY1N5bnRheEV4Y2VwdGlvbihleHApO1xyXHRcdFx0fVxyXHRcdFx0ZG9jQ29udGVudCA9IGRvY0NvbnRlbnQuc2xpY2UoZG9jQ29udGVudC5pbmRleE9mKGNvbW1lbnRFeHAuc3RhcnQpICsgY29tbWVudEV4cC5zdGFydC5sZW5ndGgpO1xyXHRcdFx0ZG9jQ29udGVudCA9IGRvY0NvbnRlbnQuc2xpY2UoMCwgZG9jQ29udGVudC5pbmRleE9mKGNvbW1lbnRFeHAuZW5kKSk7XHJcdFx0XHRkb2NDb250ZW50ID0gZG9jQ29udGVudC5yZXBsYWNlKC9eKFtcXG58XFxyXFxufFxccl0rKS8sIFwiXCIpO1xyXHRcdFx0XHJcdFx0XHR2YXIgbGluZXMgPSBkb2NDb250ZW50LnNwbGl0KC9bXFxyfFxcclxcbnxcXG5dLyk7XHJcdFx0XHRpZihsaW5lcy5sZW5ndGggJiYgIShsaW5lc1swXS50cmltKCkpKXtcclx0XHRcdFx0bGluZXMuc2hpZnQoKTtcclx0XHRcdH1cclx0XHRcdGlmKGxpbmVzLmxlbmd0aCAmJiAhKGxpbmVzW2xpbmVzLmxlbmd0aC0xXS50cmltKCkpKXtcclx0XHRcdFx0bGluZXMucG9wKCk7XHJcdFx0XHR9XHJcdFx0XHRcclx0XHRcdGlmKCEhdHJpbUluZGVudCl7XHJcdFx0XHRcdHZhciBpbmRlbnRMZW5ndGggPSA5OTk5O1xyXHRcdFx0XHRmb3IodmFyIGk9MDsgaTxsaW5lcy5sZW5ndGg7IGkrKyl7XHJcdFx0XHRcdFx0aW5kZW50TGVuZ3RoID0gTWF0aC5taW4oaW5kZW50TGVuZ3RoLCBsaW5lc1tpXS5tYXRjaCgvXlsgXFx0XSovKVswXS5sZW5ndGgpO1xyXHRcdFx0XHR9XHJcdFx0XHRcdFxyXHRcdFx0XHRmb3IodmFyIGk9MDsgaTxsaW5lcy5sZW5ndGg7IGkrKyl7XHJcdFx0XHRcdFx0bGluZXNbaV0gPSBsaW5lc1tpXS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJeKFsgXFx0XXtcIiArIGluZGVudExlbmd0aCArIFwifSlcIiksIFwiXCIpO1xyXHRcdFx0XHR9XHJcdFx0XHR9XHJcdFx0XHRkb2NDb250ZW50ID0gbGluZXMuam9pbihcIlxcblwiKTtcclx0XHRcdHJldHVybiBkb2NDb250ZW50O1xyXHRcdH0sXHJcdFx0emlwIDogKGZ1bmN0aW9uKCl7XHJcdFx0XHRpZighIUpTWmlwKXtcclx0XHRcdFx0cmV0dXJuIEpTWmlwO1xyXHRcdFx0fVxyXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwicmVxdWlyZXMgSlNaaXBcIik7XHJcdFx0fSkoKSxcclx0XHRzYXZlQXMgOiAoZnVuY3Rpb24oKXtcclx0XHRcdGlmKCEhc2F2ZUFzKXtcclx0XHRcdFx0cmV0dXJuIHNhdmVBcztcclx0XHRcdH1cclx0XHRcdHRocm93IG5ldyBFcnJvcihcInJlcXVpcmVzIHNhdmVBc1wiKTtcclx0XHR9KSgpXHJcdH07XHJccn0pKCk7Iiwid2luZG93LkFscGhhSnBnQXBwID0gd2luZG93LkFscGhhSnBnQXBwIHx8IHt9O1xyXHIoZnVuY3Rpb24oKXtcciAgICB2YXIgZmlsZUNvbnRlbnRzID0ge1xyICAgICAgICBqcyA6IEFscGhhSnBnQXBwLnV0aWwuaGVyZWRvYyhmdW5jdGlvbigpey8qXHIgICAgICAgICAgICAoZnVuY3Rpb24oKXtcciAgICAgICAgICAgICAgICB2YXIgQWxwaGEgPSB7XHIgICAgICAgICAgICAgICAgICAgIG1hc2sgOiBmdW5jdGlvbihlbG0pe1xyICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcGxhY2UgPSBmdW5jdGlvbihvcmlnaW5hbCwgbWFzayl7XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLnNldEF0dHJpYnV0ZShcIndpZHRoXCIsIG9yaWdpbmFsLm5hdHVyYWxXaWR0aCk7XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLCBvcmlnaW5hbC5uYXR1cmFsSGVpZ2h0KTtcciAgICAgICAgICAgICAgICAgICAgICAgICAgICBcciAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcciAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb24uZHJhd0ltYWdlKG1hc2ssIDAsIDApO1xyICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXNrSW1hZ2VEYXRhID0gY29uLmdldEltYWdlRGF0YSgwLCAwLCBvcmlnaW5hbC5uYXR1cmFsV2lkdGgsIG9yaWdpbmFsLm5hdHVyYWxIZWlnaHQpO1xyICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbi5kcmF3SW1hZ2Uob3JpZ2luYWwsIDAsIDApO1xyICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYWluSW1hZ2VEYXRhID0gY29uLmdldEltYWdlRGF0YSgwLCAwLCBvcmlnaW5hbC5uYXR1cmFsV2lkdGgsIG9yaWdpbmFsLm5hdHVyYWxIZWlnaHQpO1xyICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPG1haW5JbWFnZURhdGEuZGF0YS5sZW5ndGg7IGkrPTQpe1xyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24ocG9zKXtcciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5JbWFnZURhdGEuZGF0YVtwb3MgKyAzXSA9IG1hc2tJbWFnZURhdGEuZGF0YVtwb3NdO1xyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KShpKTtcciAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uLnB1dEltYWdlRGF0YShtYWluSW1hZ2VEYXRhLCAwLCAwKTtcciAgICAgICAgICAgICAgICAgICAgICAgICAgICBcciAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbC5kYXRhc2V0Lm9yaWdpbmFsSW1hZ2UgPSBvcmlnaW5hbC5nZXRBdHRyaWJ1dGUoXCJzcmNcIik7XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwuc3JjID0gY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcciAgICAgICAgICAgICAgICAgICAgICAgIH07XHIgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFzayA9IG5ldyBJbWFnZSgpO1xyICAgICAgICAgICAgICAgICAgICAgICAgbWFzay5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBmdW5jdGlvbigpe1xyICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2UoZWxtLCBtYXNrKTtcciAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZhbHNlKTtcciAgICAgICAgICAgICAgICAgICAgICAgIG1hc2suc3JjID0gZWxtLmRhdGFzZXQuYWxwaGFNYXNrO1xyICAgICAgICAgICAgICAgICAgICB9XHIgICAgICAgICAgICAgICAgfTtcciAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbigpe1xyICAgICAgICAgICAgICAgICAgICB2YXIgYWxwaGFFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWFscGhhLW1hc2tdJyk7XHIgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpPGFscGhhRWxlbWVudHMubGVuZ3RoOyBpKyspe1xyICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uKGVsbSl7XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWVsbS5jb21wbGV0ZSl7XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXNrID0gZnVuY3Rpb24oKXtcciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFscGhhLm1hc2soZWxtKTtcciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsbS5yZW1vdmVFdmVudExpc3RlbmVyKFwibG9hZFwiLCBtYXNrLCBmYWxzZSk7XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsbS5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBtYXNrLCBmYWxzZSk7XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7XHIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFscGhhLm1hc2soZWxtKTtcciAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHIgICAgICAgICAgICAgICAgICAgICAgICB9KShhbHBoYUVsZW1lbnRzW2ldKTtcciAgICAgICAgICAgICAgICAgICAgfVxyICAgICAgICAgICAgICAgIH0sIGZhbHNlKTtcciAgICAgICAgICAgIH0pKCk7XHIgICAgICAgICovfSwgdHJ1ZSksXHIgICAgICAgIGh0bWwgOiBBbHBoYUpwZ0FwcC51dGlsLmhlcmVkb2MoZnVuY3Rpb24oKXsvKlxyICAgICAgICAgICAgPGh0bWw+XHIgICAgICAgICAgICAgICAgPGhlYWQ+XHIgICAgICAgICAgICAgICAgICAgIDxtZXRhIGNoYXJzZXQ9XCJVVEYtOFwiPlxyICAgICAgICAgICAgICAgICAgICA8c2NyaXB0IHNyYz1cImFscGhhLmpzXCI+PC9zY3JpcHQ+XHIgICAgICAgICAgICAgICAgICAgIDxzdHlsZT4gYm9keXsgYmFja2dyb3VuZC1pbWFnZSA6IHVybCgnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQUJtSkxSMFFBL3dEL0FQK2d2YWVUQUFBQUNYQklXWE1BQUFzVEFBQUxFd0VBbXB3WUFBQUFCM1JKVFVVSDRBSUJGQzBZTUlWTU1nQUFBQjFwVkZoMFEyOXRiV1Z1ZEFBQUFBQUFRM0psWVhSbFpDQjNhWFJvSUVkSlRWQmtMbVVIQUFBQUwwbEVRVlE0eTJOY3NHREJmd1k4SUQ0K0hwODBBeE1EaFdEVWdNRmdBT1AvLy8veHBvT0ZDeGVPQnVMd053QUE2YU1KK2dDU1dRd0FBQUFBU1VWT1JLNUNZSUk9Jyk7IH08L3N0eWxlPlxyICAgICAgICAgICAgICAgIDwvaGVhZD5cciAgICAgICAgICAgICAgICA8Ym9keT5cciAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9XCIlTkFNRSUuanBnXCIgZGF0YS1hbHBoYS1tYXNrPVwiJU5BTUUlX21hc2suanBnXCI+XHIgICAgICAgICAgICAgICAgPC9ib2R5PlxyICAgICAgICAgICAgPC9odG1sPlxyICAgICAgICAqL30sIHRydWUpXHIgICAgfTtcciAgICBBbHBoYUpwZ0FwcC5maWxlQ29udGVudHMgPSBmaWxlQ29udGVudHM7XHJ9KSgpOyIsIndpbmRvdy5BbHBoYUpwZ0FwcCA9IHdpbmRvdy5BbHBoYUpwZ0FwcCB8fCB7fTtcclxyKGZ1bmN0aW9uKCl7XHJcdEFscGhhSnBnQXBwLnRvWmlwRmlsZSA9IGZ1bmN0aW9uKG1haW5CbG9iLCBtYXNrQmxvYil7XHJcdFx0dmFyIHppcCA9IG5ldyBBbHBoYUpwZ0FwcC51dGlsLnppcCgpO1xyXHRcdHZhciBzbGljZVRpbGwgPSBjdXJyZW50RmlsZU5hbWUuaW5kZXhPZihcIi5cIik7XHJcdFx0dmFyIG5hbWUgPSBjdXJyZW50RmlsZU5hbWUuc2xpY2UoMCwgc2xpY2VUaWxsIDwgMCA/IGN1cnJlbnRGaWxlTmFtZS5sZW5ndGggOiBzbGljZVRpbGwpO1xyXHRcdHZhciBkb2NSb290ID0gemlwLmZvbGRlcihcImh0ZG9jc1wiKTtcclx0XHRkb2NSb290LmZpbGUoXCJhbHBoYS5qc1wiLCBBbHBoYUpwZ0FwcC5maWxlQ29udGVudHMuanMpO1xyXHRcdGRvY1Jvb3QuZmlsZShcImluZGV4Lmh0bWxcIiwgQWxwaGFKcGdBcHAuZmlsZUNvbnRlbnRzLmh0bWwucmVwbGFjZSgvJU5BTUUlL2csIG5hbWUpKTtcclx0XHRkb2NSb290LmZpbGUobmFtZSArIFwiLmpwZ1wiLCBtYWluQmxvYiwgeyBiaW5hcnkgOiB0cnVlIH0pO1xyXHRcdGRvY1Jvb3QuZmlsZShuYW1lICsgXCJfbWFzay5qcGdcIiwgbWFza0Jsb2IsIHsgYmluYXJ5IDogdHJ1ZSB9KTtcclx0XHRBbHBoYUpwZ0FwcC51dGlsLnNhdmVBcyh6aXAuZ2VuZXJhdGUoeyB0eXBlIDogXCJibG9iXCIgfSksIG5hbWUgKyBcIi56aXBcIik7XHJcdH07XHJ9KSgpOyIsIndpbmRvdy5BbHBoYUpwZ0FwcCA9IHdpbmRvdy5BbHBoYUpwZ0FwcCB8fCB7fTtcclxyKGZ1bmN0aW9uKCl7XHJcclx0dmFyIGNsZWFyQ2FudmFzID0gZnVuY3Rpb24oaW1hZ2VSZXN1bHRBcmVhLCBtYWluQ2FudmFzLCBtYXNrQ2FudmFzKXtcclx0XHRpZighIW1haW5DYW52YXMud2lkdGggJiYgISFtYWluQ2FudmFzLmhlaWdodCl7XHJcdFx0XHRtYWluQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKS5jbGVhclJlY3QoMCwgMCwgbWFpbkNhbnZhcy53aWR0aCwgbWFpbkNhbnZhcy5oZWlnaHQpO1xyXHRcdH1cclx0XHRpZighIW1hc2tDYW52YXMud2lkdGggJiYgISFtYXNrQ2FudmFzLmhlaWdodCl7XHJcdFx0XHRtYXNrQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKS5jbGVhclJlY3QoMCwgMCwgbWFza0NhbnZhcy53aWR0aCwgbWFza0NhbnZhcy5oZWlnaHQpO1xyXHRcdH1cclx0XHRcclx0XHR2YXIgcmVzdWx0SW1hZ2VzID0gaW1hZ2VSZXN1bHRBcmVhLnF1ZXJ5U2VsZWN0b3JBbGwoXCJJTUdcIik7XHJcdFx0Zm9yKHZhciBpPTA7IGk8cmVzdWx0SW1hZ2VzLmxlbmd0aDsgaSsrKXtcclx0XHRcdHJlc3VsdEltYWdlc1tpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJlc3VsdEltYWdlc1tpXSk7XHJcdFx0fVxyXHR9O1xyXHRcclx0dmFyIGNvbmZpcm1JbWFnZSA9IGZ1bmN0aW9uKGVsZW1lbnRzKXtcclx0XHR2YXIgZmlsZSA9IGVsZW1lbnRzLmltYWdlSW5wdXQuZmlsZXNbMF07XHJcdFx0dmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcdFx0cmVhZGVyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uKCl7XHJcdFx0XHRlbGVtZW50cy5jb25maXJtSW1hZ2UucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJub2ltYWdlXCIpO1xyXHRcdFx0ZWxlbWVudHMuY29uZmlybUltYWdlLnNyYyA9IHJlYWRlci5yZXN1bHQ7XHJcdFx0fVxyXHRcdGlmKCEhZmlsZSl7XHJcdFx0XHRyZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclx0XHRcdGNsZWFyQ2FudmFzKGVsZW1lbnRzLmltYWdlUmVzdWx0cywgZWxlbWVudHMubWFpbkNhbnZhcywgZWxlbWVudHMubWFza0NhbnZhcyk7XHJcdFx0XHRjdXJyZW50RmlsZU5hbWUgPSBmaWxlLm5hbWU7XHJcdFx0XHRcclx0XHRcdGVsZW1lbnRzLmZpbGVzaXplSW5mby5pbm5lckhUTUwgPSBmaWxlLnNpemUgKyBcImJ5dGVcIjtcclx0XHR9XHJcdFx0ZWxzZXtcclx0XHRcdGVsZW1lbnRzLmNvbmZpcm1JbWFnZS5zcmMgPSBcIlwiO1xyXHRcdFx0ZWxlbWVudHMuY29uZmlybUltYWdlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKFwibm9pbWFnZVwiKTtcclx0XHRcdGNsZWFyQ2FudmFzKGVsZW1lbnRzLmltYWdlUmVzdWx0cywgZWxlbWVudHMubWFpbkNhbnZhcywgZWxlbWVudHMubWFza0NhbnZhcyk7XHJcdFx0fVxyXHR9O1xyXHRcclx0dmFyIGNhbnZhczJqcGcgPSBmdW5jdGlvbihjYW52YXMsIGpwZ0xldmVsKXtcclx0XHR2YXIgZGF0YXVybCA9IGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9qcGVnXCIsIGpwZ0xldmVsKTtcclx0XHR2YXIgYmluID0gYXRvYihkYXRhdXJsLnNwbGl0KFwiLFwiKVsxXSk7XHJcdFx0dmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGJpbi5sZW5ndGgpO1xyXHRcdGZvcih2YXIgaT0wOyBpPGJpbi5sZW5ndGg7IGkrKyl7XHJcdFx0XHRidWZmZXJbaV0gPSBiaW4uY2hhckNvZGVBdChpKTtcclx0XHR9XHJcdFx0cmV0dXJuIGJ1ZmZlcjtcclx0fTtcclx0XHJcdHZhciBjb252MmpwZyA9IGZ1bmN0aW9uKGVsZW1lbnRzKXtcclx0XHR2YXIganBnTGV2ZWwgPSBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCBlbGVtZW50cy5qcGdMZWJlbElucHV0LnZhbHVlIC8gMTAwKSk7XHJcdFx0dmFyIHNyYyA9IGVsZW1lbnRzLmNvbmZpcm1JbWFnZS5nZXRBdHRyaWJ1dGUoXCJzcmNcIik7XHJcdFx0dmFyIGNhbnZhc2VzID0ge1xyXHRcdFx0bWFpbiA6IGVsZW1lbnRzLm1haW5DYW52YXMsXHJcdFx0XHRtYXNrIDogZWxlbWVudHMubWFza0NhbnZhc1xyXHRcdH07XHJcdFx0Y2xlYXJDYW52YXMoZWxlbWVudHMuaW1hZ2VSZXN1bHRzLCBlbGVtZW50cy5tYWluQ2FudmFzLCBlbGVtZW50cy5tYXNrQ2FudmFzKTtcclx0XHRcclx0XHRmb3IodmFyIHR5cGUgaW4gY2FudmFzZXMpe1xyXHRcdFx0KGZ1bmN0aW9uKGNhbnZhcyl7XHJcdFx0XHRcdHZhciBjb24gPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXHRcdFx0XHRjYW52YXMuc2V0QXR0cmlidXRlKFwid2lkdGhcIiwgZWxlbWVudHMuY29uZmlybUltYWdlLm5hdHVyYWxXaWR0aCk7XHJcdFx0XHRcdGNhbnZhcy5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIiwgZWxlbWVudHMuY29uZmlybUltYWdlLm5hdHVyYWxIZWlnaHQpO1xyXHRcdFx0XHRjb24uZHJhd0ltYWdlKGVsZW1lbnRzLmNvbmZpcm1JbWFnZSwgMCwgMCk7XHJcdFx0XHR9KShjYW52YXNlc1t0eXBlXSk7XHJcdFx0fVxyXHRcdFxyXHRcdHZhciBtYWluQ29uID0gY2FudmFzZXMubWFpbi5nZXRDb250ZXh0KFwiMmRcIik7XHJcdFx0dmFyIG1haW5JbWFnZURhdGEgPSBtYWluQ29uLmdldEltYWdlRGF0YSgwLCAwLCBlbGVtZW50cy5jb25maXJtSW1hZ2UubmF0dXJhbFdpZHRoLCBlbGVtZW50cy5jb25maXJtSW1hZ2UubmF0dXJhbEhlaWdodCk7XHJcdFx0Zm9yKHZhciBpPTA7IGk8bWFpbkltYWdlRGF0YS5kYXRhLmxlbmd0aDsgaSs9NCl7XHJcdFx0XHQoZnVuY3Rpb24ocG9zKXtcclx0XHRcdFx0bWFpbkltYWdlRGF0YS5kYXRhW3BvcyArIDNdID0gMjU1O1xyXHRcdFx0fSkoaSk7XHJcdFx0fVxyXHRcdG1haW5Db24ucHV0SW1hZ2VEYXRhKG1haW5JbWFnZURhdGEsIDAsIDApO1xyXHJcdFx0dmFyIG1hc2tDb24gPSBjYW52YXNlcy5tYXNrLmdldENvbnRleHQoXCIyZFwiKTtcclx0XHR2YXIgbWFza0ltYWdlRGF0YSA9IG1hc2tDb24uZ2V0SW1hZ2VEYXRhKDAsIDAsIGVsZW1lbnRzLmNvbmZpcm1JbWFnZS5uYXR1cmFsV2lkdGgsIGVsZW1lbnRzLmNvbmZpcm1JbWFnZS5uYXR1cmFsSGVpZ2h0KTtcclx0XHRmb3IodmFyIGk9MDsgaTxtYXNrSW1hZ2VEYXRhLmRhdGEubGVuZ3RoOyBpKz00KXtcclx0XHRcdChmdW5jdGlvbihwb3Mpe1xyXHRcdFx0XHRtYXNrSW1hZ2VEYXRhLmRhdGFbcG9zICsgMF0gPSBtYXNrSW1hZ2VEYXRhLmRhdGFbcG9zICsgM107XHJcdFx0XHRcdG1hc2tJbWFnZURhdGEuZGF0YVtwb3MgKyAxXSA9IG1hc2tJbWFnZURhdGEuZGF0YVtwb3MgKyAzXTtcclx0XHRcdFx0bWFza0ltYWdlRGF0YS5kYXRhW3BvcyArIDJdID0gbWFza0ltYWdlRGF0YS5kYXRhW3BvcyArIDNdO1xyXHRcdFx0XHRtYXNrSW1hZ2VEYXRhLmRhdGFbcG9zICsgM10gPSAyNTU7XHJcdFx0XHRcdFxyXHRcdFx0fSkoaSk7XHJcdFx0fVxyXHRcdG1hc2tDb24ucHV0SW1hZ2VEYXRhKG1hc2tJbWFnZURhdGEsIDAsIDApO1xyXHJcdFx0QWxwaGFKcGdBcHAudG9aaXBGaWxlKGNhbnZhczJqcGcoY2FudmFzZXMubWFpbiwganBnTGV2ZWwpLCBjYW52YXMyanBnKGNhbnZhc2VzLm1hc2ssIGpwZ0xldmVsKSk7XHJcdH07XHJcclxyXHRBbHBoYUpwZ0FwcC5zZXR1cCA9IGZ1bmN0aW9uKGVsZW1lbnRzKXtcclx0XHRlbGVtZW50cy5pbWFnZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZnVuY3Rpb24oKXtcclx0XHRcdGNvbmZpcm1JbWFnZShlbGVtZW50cyk7XHJcdFx0fSwgZmFsc2UpO1xyXHRcdFxyXHRcdGVsZW1lbnRzLmNyZWF0ZVRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKCl7XHJcdFx0XHRjb252MmpwZyhlbGVtZW50cyk7XHJcdFx0fSwgZmFsc2UpO1xyXHR9O1xyfSkoKTsiLCJ3aW5kb3cuQWxwaGFKcGdBcHAgPSB3aW5kb3cuQWxwaGFKcGdBcHAgfHwge307XHJkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbigpe1xyXHRBbHBoYUpwZ0FwcC5zZXR1cCh7XHJcdFx0aW1hZ2VJbnB1dCA6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW1hZ2VfaW5wdXRcIiksXHJcdFx0aW1hZ2VSZXN1bHRzIDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbWFnZV9yZXN1bHRzXCIpLFxyXHRcdG1haW5DYW52YXMgOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1haW5fY2FudmFzXCIpLFxyXHRcdG1hc2tDYW52YXMgOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1hc2tfY2FudmFzXCIpLFxyXHRcdGZpbGVzaXplSW5mbyA6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZmlsZXNpemVcIiksXHJcdFx0Y29uZmlybUltYWdlIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjb25maXJtX2ltZyA+IElNR1wiKSxcclx0XHRjcmVhdGVUcmlnZ2VyIDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbWFnZV9jcmVhdGVcIiksXHJcdFx0anBnTGViZWxJbnB1dCA6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW1hZ2VfbGV2ZWxcIiksXHJcdFx0XHJcdH0pO1xyfSwgZmFsc2UpOyJdfQ==
